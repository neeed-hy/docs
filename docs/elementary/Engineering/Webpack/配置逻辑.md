---
sidebar_position: 1
description: 'Webpack 的配置逻辑'
---

# 配置逻辑

## 工作流程与配置项

**Webpack** 打包过程大致上可以简化为：

```txt
输入=>模块处理=>后处理=>输出
```

- 输入：从文件系统读入代码文件
- 模块递归处理：调用 Loader 转移 Module 内容，并将结果转换为 AST，从中分析出模块依赖关系，进一步递归调用模块处理过程，直到所有文件处理完毕。
- 后处理：所有依赖模块处理完毕后开始执行后处理，包括模块合并、注入运行时、产物优化等，最终输出 Chunk 集合
- 输出：将 Chunk 写出到外部文件系统

从上述打包角度，Webpack 配置项大体上可分为两类：

- **流程类**：作用于打包流程某个或若干个环节，直接影响打包效果的配置项
- **工具类**：打包主流程之外，提供更多工程化工具的配置项

### 流程类配置

典型的**流程类配置**项有：

- 输入输出
  - `entry`:项目入口文件，Webpack 工作的起点
  - `context`:项目执行上下文路径
  - `output`:产物输出路径
- 模块处理
  - `resolve`:用于配置模块路径解析规则，用于帮助 Webpack 准确的找到指定模块
  - `module`:用于配置模块加载规则，例如针对什么类型的资源需要使用哪些 Loader 来进行处理
  - `externals`:用于声明外部资源。Webpack 会直接忽略这部分资源，跳过这些资源的解析和打包。
- 后处理
  - `optimization`:用于控制如何优化产物包的体积，也包括代码压缩、混淆等功能。
  - `target`:用于配置编译产物的目标运行环境，支持 web、node、electron 等值，不同值最终产物会有所差异。
  - `mode`:编译模式短语，典型的有 development、production 等值，可以理解为一种声明环境的短语

在进行了上面的配置之后，Webpack 会根据配置进行下面的打包流程：

- **首先**根据输入配置(`entry/context`等)找到项目入口文件
- **其次**根据模块处理配置(`resolve/module/externals`等)逐一处理模块文件，处理过程包括依赖分析、转译 ast 等等。
- **最后**根据后处理配置(`optimization/target`等)进行优化产物结构、合并模块资源等工作，最后输出。

### 工具类配置

典型的**工具类配置**项有：

- 提升开发效率
  - `devServer`:热更新服务器
  - `devtool`:Sourcemap 生成规则
  - `watch`:持续监听文件变化，持续构建
- 性能优化
  - `cache`:Webpack5 之后，可以利用此配置项来控制如何缓存编译过程信息与编译结果
  - `performance`:用于配置当产物大小超过阈值时，如何通知开发者
- 日志类
  - `stats`:用于精确地控制编译过程的日志内容，在做比较细致的性能调试时非常有用
  - `infrastructureLogging`:用于控制日志输出方式，例如可以通过该配置将日志输出到磁盘文件

每一个工具类配置都在**主流程之外**提供**额外的工程化能力**，通常一个配置项专注于解决一类工程问题。

## 总结

Webpack 虽然有很多种配置项，但是大体上可以分为两类：**流程类配置**和**工具类配置**。流程类配置会参与到 Webpack 打包的主流程当中，而工具类配置则聚焦在解决某一个工程类问题。

## 思考题

- 流程类与工具类配置有什么区别？分别有什么特点？
- 都有哪些常见的流程类配置项？
- 都有哪些常见的工具类配置项？
