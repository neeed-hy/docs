---
sidebar_position: 2
description: '一些实际的 Webpack 配置，用来加深印象和理解'
---

# 案例分析

## 基本的 Babel + TS + ESLint 的配置

```js
module.exports = {
  entry: './src/index.ts',
  mode: 'development',
  devtool: false,
  output: {
    filename: '[name].js',
    path: path.resolve(__dirname, 'dist'),
  },
  module: {
    rules: [
      {
        test: /\.ts$/,
        use: 'ts-loader'
      },
    ],
  },
  resolve: {
    extensions: ['.ts', '.js'],
  }
  plugins: [new ESLintPlugin({ extensions: ['.js', '.ts'] })],
}
```

配置解析：

- 首先是一些基本的输入输出配置
- `module` 属性用来声明模块处理规则，`module.rules` 则包含具体的规则(也就是什么类型的文件使用哪些 Loader 处理器)。`module.rules`中的属性：
  - `test`:使用正则表达式，来声明该规则的过滤条件。只有命中正则的文件才会应用这条规则。本例中表示对所有的 `.ts` 文件生效。
  - `use`:用于声明这条规则的 Loader 处理序列。命中规则的文件会被传入 Loader 序列进行**转译处理**。
- `resolve.extensions` 属性则会自动解析 `.ts` 文件，代码如 `import "./a.ts"` 可以忽略后缀声明，简化为 `import "./a"` 文件
- `plugins` 插件。这里添加了 `ESLintPlugin` 的插件，用来使用 ESLint。

## 处理 CSS 资源

### 常规处理方式

webpack 默认情况下只能用来处理 JavaScript 代码，无法处理 CSS 代码。因此，需要引入额外的 Loader 来处理 CSS 文件。

常见的用来处理 CSS 的 Loader 有：

- `css-loader`:该 Loader 会将 CSS 翻译成例如`module.exports = "${css}"`的 JavaScript 代码，使得 webpack 有能力进行处理。
- `style-loader`:该 Loader 会在产物中注入一系列 runtime 代码，这些代码会将 CSS 内容注入到页面的 `<style>` 标签，使得样式生效。
- `mini-css-extract-plugin`:该插件会将 CSS 代码抽离到单独的 `.css` 文件，并将文件通过 `<link>` 标签的方式插入到页面中。

简单来说，`css-loader`让 webpack 能够正确理解 CSS 代码，而`style-loader`和`mini-css-extract-plugin`则能通过适当方式将 CSS 插入到页面，对页面样式产生影响。

一份最基本的 CSS 处理配置如下：

```js
module.exports = {
  module: {
    rules: [
      {
        test: /\.css$/i,
        use: ['style-loader', 'css-loader'],
      },
    ],
  },
}
```

一定要注意 `style-loader` `在前，css-loader` 在后。

这在语义上相当于 `style-loader(css-loader(css))` 的链式调用。

如果要使用 `mini-css-extract-plugin` 的话，要这样进行配置：

```js
const MiniCssExtractPlugin = require('mini-css-extract-plugin')
const HTMLWebpackPlugin = require('html-webpack-plugin')

module.exports = {
  module: {
    rules: [
      {
        test: /\.css$/,
        use: [
          // 根据运行环境判断使用那个 loader
          process.env.NODE_ENV === 'development'
            ? 'style-loader'
            : MiniCssExtractPlugin.loader,
          'css-loader',
        ],
      },
    ],
  },
  plugins: [new MiniCssExtractPlugin(), new HTMLWebpackPlugin()],
}
```

其中这两个 plugin 都是 `mini-css-extract-plugin` 想要正常工作所需要的；`mini-css-extract-plugin` 和 `style-loader` 不能同时使用；可以在开发环境使用 `style-loader` 来获取更好的热更新性能，在生产环境使用 `mini-css-extract-plugin`。

### CSS 预处理器

最知名的 CSS 预处理器有 Less/Sass/Stylus.同样的，也只需要接入相应的 Loader 就可以在 webpack 中进行使用。以使用 Less 为例，基本配置如下：

```js
module.exports = {
  module: {
    rules: [
      {
        test: /\.less$/,
        use: ['style-loader', 'css-loader', 'less-loader'],
      },
    ],
  },
}
```

同样需要保证 Loader 的顺序。`less-loader`的作用在于将 Less 代码转化为 CSS 代码。

## Vue 基础配置

一份典型的配置如下：

```js
const { VueLoaderPlugin } = require('vue-loader')

module.exports = {
  devServer: {
    hot: true,
    open: true,
  },
  module: {
    rules: [
      { test: /\.pug$/, use: ['pug-plain-loader'] },
      { test: /\.vue$/, use: ['vue-loader'] },
      { test: /\.ts$/, use: ['ts-loader'] },
      {
        test: /\.less$/,
        use: ['style-loader', 'css-loader', 'less-loader'],
      },
    ],
  },
  plugins: [new VueLoaderPlugin()],
}
```

- `devServer.hot`：用于声明是否使用热更新能力，接受 bool 值。
- `devServer.open`：用于声明是否自动打开页面，接受 bool 值。

module 中定义了一些规则，不同种类的文件调用不同种类的 Loader。

## React 基础配置

一份典型的配置如下：

```js
module.exports = {
  resolve: {
    extensions: ['.js', '.jsx', '.ts', '.tsx'],
  },
  module: {
    rules: [
      {
        test: /\.tsx$/,
        use: 'ts-loader',
      },
      {
        test: /\.less$/,
        use: ['style-loader', 'css-loader', 'less-loader'],
      },
    ],
  },
}
```

可以直接使用 `ts-loader` 来处理 `.tsx` 文件。
