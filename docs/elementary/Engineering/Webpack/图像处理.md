---
sidebar_position: 3
description: '使用 Webpack 处理图像'
---

# 图像处理

## Webpack 4 中导入图像

原生 Webpack 4 只能处理标准 JavaScript 模块，因此需要借助 Loader —— 例如 `file-loader`、`url-loader`、`raw-loader` 等完成图像加载操作。

典型的配置如下：

```js
module.exports = {
  // ...
  module: {
    rules: [
      {
        test: /\.(png|jpg)$/,
        use: ['file-loader'],
      },
      {
        test: /\.(png|jpg)$/,
        use: [
          {
            loader: 'url-loader',
            options: {
              limit: 1024,
            },
          },
        ],
      },
      {
        test: /\.svg$/i,
        use: ['raw-loader'],
      },
    ],
  },
}
```

上面的配置中使用了三种 Loader。他们的特点在于：

- `file-loader`:将图像引用转换为 url 语句并生成相应图片文件。原始图片会被重命名并复制到产物文件夹，同时在代码中插入图片 URL 地址。
- `url-loader`:对于小于阈值 limit 的图像直接转化为 base64 编码；大于阈值的图像则调用 `file-loader` 进行加载.
- `raw-loader`:不做任何转译，只是简单将文件内容复制到产物中，适用于 SVG 场景。

## Webpack 5 中导入图像

由于上述的 Loader 过于常用，Webpack 5 直接将其内置支持。在处理这些资源时，只需要通过 `module.rules.type` 属性指定资源类型即可。

改写上面的配置文件：

```js
module.exports = {
  // ...
  module: {
    rules: [
      {
        test: /\.(png|jpg)$/,
        // use: ['file-loader'],
        type: 'asset/resource',
      },
      {
        test: /\.(png|jpg)$/,
        // use: [
        //   {
        //     loader: 'url-loader',
        //     options: {
        //       limit: 1024,
        //     },
        //   },
        // ],
        type: 'asset',
        parser: {
          dataUrlCondition: {
            maxSize: 1024, // 1kb
          },
        },
      },
      {
        test: /\.svg$/i,
        // use: ['raw-loader'],
        type: 'asset/source',
      },
    ],
  },
}
```

## 图像优化

可以使用一些工具来对 Webpack 的图像性能进行优化，包括：

- `image-webpack-loader`:压缩图片
- `webpack-spritesmith`:雪碧图
- `responsive-loader`:响应式图片

当然，最好的办法还是放在 CDN 上。
